{
  "nodes": [
    {
      "unique-id": "customer",
      "node-type": "actor",
      "name": "Customer",
      "description": "End user making a payment transaction through the checkout process"
    },
    {
      "unique-id": "checkout-page",
      "node-type": "webclient",
      "name": "Checkout Page",
      "description": "PCI-DSS compliant payment form for secure card data entry",
      "controls": {
        "input-validation": {
          "description": "Client-side validation of card number format and CVV",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "secure-transmission": {
          "description": "All payment data transmitted over TLS 1.2 or higher",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "web-application-firewall-protection": {
          "description": "Added 'web-application-firewall-protection' control to address PCI-DSS 4.0 Req 6.4.2, which requires public-facing web applications to be protected against attacks. The 'checkout-page' is a critical public-facing component."
        }
      }
    },
    {
      "unique-id": "payment-api",
      "node-type": "service",
      "name": "Payment API",
      "description": "Payment processing endpoint orchestrating tokenization, fraud detection, and authorization",
      "controls": {
        "pci-dss-compliance": {
          "description": "PCI-DSS SAQ-D compliant service with annual assessment",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "api-authentication": {
          "description": "API key authentication with rate limiting and IP whitelisting",
          "requirements": [
            {
              "requirement-url": "https://owasp.org/www-project-api-security/"
            }
          ]
        },
        "secrets-management-solution": {
          "description": "Added 'secrets-management-solution' control to address the critical gap in secrets management (CCC-IAM-05, CCC-CIS-06; NIST CSF 2.0 PR.AA-01). Explicitly required for secure credential handling, beyond basic API key authentication."
        }
      }
    },
    {
      "unique-id": "tokenization-service",
      "node-type": "service",
      "name": "Tokenization Service",
      "description": "PCI-DSS card tokenization service replacing sensitive card data with tokens",
      "controls": {
        "encryption-at-rest": {
          "description": "AES-256 encryption for stored card data in secure vault",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "key-management": {
          "description": "HSM-based key management with key rotation every 90 days",
          "requirements": [
            {
              "requirement-url": "https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final"
            }
          ]
        },
        "access-logging": {
          "description": "Comprehensive audit logging of all vault access with tamper detection",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "cryptographic-key-certificate-inventory": {
          "description": "Added 'cryptographic-key-certificate-inventory' control to address PCI-DSS 4.0 Req 4.2.1.1, requiring an inventory of trusted keys and certificates used for PAN transmission. Existing key management was partial in its scope."
        }
      },
      "data-classification": "RESTRICTED"
    },
    {
      "unique-id": "fraud-detection",
      "node-type": "service",
      "name": "Fraud Detection",
      "description": "ML-based fraud scoring engine analyzing transaction patterns and risk indicators",
      "controls": {
        "model-monitoring": {
          "description": "Monitor ML model performance and retrain quarterly on new fraud patterns",
          "requirements": [
            {
              "requirement-url": "https://www.iso.org/standard/54534.html"
            }
          ]
        }
      }
    },
    {
      "unique-id": "transaction-database",
      "node-type": "database",
      "name": "Transaction Database",
      "description": "Payment transaction records and authorization history",
      "controls": {
        "data-encryption": {
          "description": "Transparent data encryption for all payment transaction records",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "audit-logging": {
          "description": "Database audit trail for all access to payment records",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        },
        "data-retention": {
          "description": "Retain transaction records for 3 years, securely delete afterward",
          "requirements": [
            {
              "requirement-url": "https://www.visa.com/splisting/searchGrsp.do?companyNameCriteria=data%20retention"
            }
          ]
        },
        "Retain transaction records for 7 years (SEC Rule 17a-4), securely delete afterward": {
          "description": "Updated 'data-retention' control to meet SOX Data Management: Data retention requirements (SEC Rule 17a-4) by extending the policy from 3 years to 7 years. Original control was partial and non-compliant with SOX."
        }
      },
      "data-classification": "CONFIDENTIAL"
    },
    {
      "unique-id": "card-network",
      "node-type": "system",
      "name": "Card Network",
      "description": "External card network (Visa/Mastercard) for authorization and settlement",
      "controls": {
        "third-party-risk-management-program": {
          "description": "Added 'third-party-risk-management-program' control to address missing Third-Party Risk Management (CCC-CGO-05; NIST CSF 2.0 GV.SC-02; SOC2 TSC CC9.2). Critical for managing risks from external dependencies."
        }
      }
    },
    {
      "unique-id": "cardholder-data",
      "node-type": "data-asset",
      "name": "Cardholder Data",
      "description": "PCI-DSS scoped cardholder data including PAN, CVV, and expiration date",
      "controls": {
        "data-minimization": {
          "description": "Collect only minimum required cardholder data, never store CVV",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        }
      },
      "data-classification": "RESTRICTED"
    }
  ],
  "relationships": [
    {
      "unique-id": "customer-to-checkout",
      "description": "Customer enters payment information on checkout page",
      "relationship-type": "interacts",
      "interacts": {
        "actor": "customer",
        "nodes": [
          "checkout-page"
        ]
      }
    },
    {
      "unique-id": "checkout-to-payment-api",
      "description": "Checkout page submits encrypted payment data to payment API",
      "protocol": "HTTPS",
      "controls": {
        "tls-enforcement": {
          "description": "Enforce TLS 1.2 minimum with strong cipher suites",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss"
            }
          ]
        }
      },
      "relationship-type": "connects",
      "connects": {
        "source": {
          "node": "checkout-page"
        },
        "destination": {
          "node": "payment-api"
        }
      }
    },
    {
      "unique-id": "payment-api-to-tokenization",
      "description": "Payment API requests card tokenization",
      "protocol": "mTLS",
      "relationship-type": "connects",
      "connects": {
        "source": {
          "node": "payment-api"
        },
        "destination": {
          "node": "tokenization-service"
        }
      }
    },
    {
      "unique-id": "payment-api-to-fraud",
      "description": "Payment API checks transaction for fraud indicators",
      "protocol": "HTTPS",
      "relationship-type": "connects",
      "connects": {
        "source": {
          "node": "payment-api"
        },
        "destination": {
          "node": "fraud-detection"
        }
      }
    },
    {
      "unique-id": "payment-api-to-db",
      "description": "Payment API persists transaction records",
      "protocol": "TLS",
      "relationship-type": "connects",
      "connects": {
        "source": {
          "node": "payment-api"
        },
        "destination": {
          "node": "transaction-database"
        }
      }
    },
    {
      "unique-id": "tokenization-to-card-network",
      "description": "Tokenization service forwards authorization request to card network",
      "protocol": "mTLS",
      "relationship-type": "connects",
      "connects": {
        "source": {
          "node": "tokenization-service"
        },
        "destination": {
          "node": "card-network"
        }
      }
    }
  ],
  "flows": [
    {
      "unique-id": "payment-processing-flow",
      "name": "Payment Processing Flow",
      "description": "Complete payment flow from customer card entry through authorization",
      "transitions": [
        {
          "relationship-unique-id": "customer-to-checkout",
          "sequence-number": 1,
          "description": "Customer enters card details on checkout page"
        },
        {
          "relationship-unique-id": "checkout-to-payment-api",
          "sequence-number": 2,
          "description": "Checkout submits encrypted payment to API"
        },
        {
          "relationship-unique-id": "payment-api-to-fraud",
          "sequence-number": 3,
          "description": "Payment API checks fraud score"
        },
        {
          "relationship-unique-id": "payment-api-to-tokenization",
          "sequence-number": 4,
          "description": "Payment API requests tokenization"
        },
        {
          "relationship-unique-id": "tokenization-to-card-network",
          "sequence-number": 5,
          "description": "Tokenization service authorizes with card network"
        },
        {
          "relationship-unique-id": "payment-api-to-db",
          "sequence-number": 6,
          "description": "Payment API records transaction"
        }
      ]
    }
  ],
  "controls": {
    "governance-cybersecurity-policy-risk-mgt": {
      "description": "Added 'governance-cybersecurity-policy-risk-mgt' control to address missing cybersecurity policy, risk management strategy (NIST CSF 2.0 GV.PO-01, GV.RM-01, CCC-CGO-01, CCC-CGO-04), and SDLC governance (SOX, CCC-SDD) across multiple frameworks. Critical for establishing foundational security posture."
    },
    "change-management-process": {
      "description": "Added 'change-management-process' control to address missing formal change management across SOX (Change Management: Request and approval, Testing requirements, Deployment controls, Emergency change procedures), CCC-SDD-10, and SOC2 TSC CC8.1 requirements. Critical for controlled and secure system modifications."
    },
    "incident-response-disaster-recovery-plan": {
      "description": "Added 'incident-response-disaster-recovery-plan' control to address critical gaps in Incident Response and Disaster Recovery (SOX Operations: Backup and recovery, Incident management; PCI-DSS 12.10.1; CCC-RES-01, CCC-RES-02; NIST CSF 2.0 PR.DS-11, RS.MA-01, RC.RP-01; SOC2 TSC CC7.4, CC7.5, A1.3). Includes automated backup, high availability, and comprehensive IR/DR procedures."
    },
    "vulnerability-management-program": {
      "description": "Added 'vulnerability-management-program' control to address missing vulnerability management (SOX; PCI-DSS 11.3.1, 11.4.1; CCC-SDD-03/04/05; NIST CSF 2.0 ID.RA-01; SOC2 TSC CC9.1). Ensures proactive identification and remediation of security flaws."
    },
    "network-security-segmentation-firewall": {
      "description": "Added 'network-security-segmentation-firewall' control to address missing network segmentation, firewall controls, and IDS/IPS (PCI-DSS 1.2.1, 1.3, 11.5.1; CCC-NET-01, CCC-NET-03; NIST CSF 2.0 PR.IR-01, DE.CM-01; SOC2 TSC CC6.6, CC7.1). Critical for protecting sensitive data environments."
    },
    "multi-factor-authentication-cde-privileged": {
      "description": "Added 'multi-factor-authentication-cde-privileged' control to address critical missing MFA for CDE and privileged access (PCI-DSS 8.4.2; CCC-IAM-01; NIST CSF 2.0 PR.AA-03; SOC2 TSC CC6.5). Essential for strengthening identity and access management."
    },
    "centralized-logging-siem-monitoring": {
      "description": "Added 'centralized-logging-siem-monitoring' control to address missing centralized logging, SIEM integration, and clear log retention policies (CCC-LOG-01, CCC-LOG-03; SOC2 TSC CC7.3; NIST CSF DE.CM-01). Essential for comprehensive security monitoring and forensic capabilities."
    },
    "role-based-access-control-least-privilege": {
      "description": "Added 'role-based-access-control-least-privilege' control to address missing comprehensive RBAC and least privilege (PCI-DSS 7.2; CCC-IAM-02; NIST CSF 2.0 PR.AA-05; SOC2 TSC CC6.1, CC6.3). Existing access controls were partial."
    },
    "secure-development-lifecycle-practices": {
      "description": "Consolidated control to address missing secure software engineering techniques and SDLC governance (PCI-DSS 6.2.4; SOX Software Development; CCC-SDD-03/04/05). Essential for building secure applications."
    },
    "endpoint-malware-protection": {
      "description": "Consolidated control to address missing malicious code detection and endpoint protection (NIST CSF 2.0 DE.CM-04; SOC2 TSC CC7.2). Critical for preventing and detecting malware infections."
    },
    "soc2-user-provisioning-authorization": {
      "description": "Added 'soc2-user-provisioning-authorization' control to address SOC2 TSC CC6.2, requiring registration and authorization of new users. No explicit control found."
    },
    "soc2-access-revocation": {
      "description": "Added 'soc2-access-revocation' control to address SOC2 TSC CC6.4 and SOX Termination Procedures, ensuring credentials and access are revoked upon termination. No explicit control found."
    },
    "sox-job-scheduling-monitoring": {
      "description": "Added 'sox-job-scheduling-monitoring' control to address SOX Operations: Job scheduling and monitoring. 'fraud-detection' has model monitoring, but general job scheduling and monitoring is missing."
    },
    "sox-capacity-planning": {
      "description": "Added 'sox-capacity-planning' control to address SOX Operations: Capacity planning, ensuring performance and stability of financial systems. No explicit control found."
    },
    "sox-data-integrity": {
      "description": "Added 'sox-data-integrity' control to address SOX Data Management: Data integrity, ensuring accuracy and completeness of financial data. No explicit control found."
    },
    "sox-session-management": {
      "description": "Added 'sox-session-management' control to address SOX Access Controls: Session management, requiring secure session controls for financial applications. No explicit control found."
    },
    "sox-access-reviews": {
      "description": "Added 'sox-access-reviews' control to address SOX Access Controls: Access reviews, requiring periodic reviews of access to financial data systems. No explicit control found."
    }
  }
}